{% extends "_base.html" %}

{% block title %}{{ forum.name }}{% endblock %}

{% block content %}
    {% if g.user and g.user.admin %}
        <div class="forum-admin">
            <a href="{{url_for('edit_forum', forum_id=forum.id)}}">Editovat fórum</a>
        </div>
    {% endif %}
    <h1><a href="{{url_for('index')}}">RHForum</a> » <a href="{{forum.url}}">{{forum.name}}</a></h1>
    <div class="forum-desc">
        {{ forum.description }}
    </div>
    <div class="threads">
        {% for thread in threads %}
            <div class="row">
                <div class="row-data">
                    <div class="row-total">
                        {{ txt_posts(thread.num_posts) }}
                        {% if g.user.unread(thread) %}
                            <a class="new-icon" href="{{g.user.unread(thread).url}}">NEW</a>
                        {% endif %}
                    </div>
                    {% if thread.num_posts %}
                        <div class="row-last" title="{{thread.last_post.timestamp|datetime}}">{{ago(thread.laststamp)}} <a href="{{thread.last_post.url}}"> od <i>{{ thread.last_post.author.name }}</i></a></div>
                    {% endif %}
                </div>
                <a class="row-text" href="{{thread.url}}">
                    <div class="row-name">{{thread.name}} <span class="author" href="#">{{thread.author.name}}</span></div>
                    <div class="row-description">{{thread.description or "&nbsp;"|safe}} </div>
                </a>
            </div>
        {% else %}
            Ještě tu žádná témata nejsou.
        {% endfor %}
    </div>
    {% if g.user and form %}
        <h2>Nové téma</h2>
        <form method="POST" class="new-thread">
            {{ form.name(tabindex=1) }}
            <div class="post">
                <div class="post-sidebar">
                    <div><a href="{{ g.user.url }}">{{ g.user.name }}</a></div>
                    <div class="post-avatar">
                        {% if g.user.avatar_url %}
                            <img src="{{g.user.avatar_url}}" class="avatar">
                        {% endif %}
                    </div>
                </div>
                    <div class="post-contents">
                        <div class="post-data">
                            {{ now | datetime }}
                        </div>
                        <div class="post-text">
                            {{ form.text(tabindex=2) }}
                        </div>
                        <div class="new-post-controls">
                            {{ form.submit(tabindex=3) }}
                        </div>
                    </div>
                </div>
            </div>
        </form>
    {% endif %}
{% endblock %}
